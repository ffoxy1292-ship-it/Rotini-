// Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª
let posts = JSON.parse(localStorage.getItem('routinyat-posts')) || [];

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
function displayPosts() {
    const postsGrid = document.getElementById('postsGrid');
    const recentPosts = posts.slice(0, 6); // Ø¹Ø±Ø¶ Ø¢Ø®Ø± 6 Ù…Ø´Ø§Ø±ÙƒØ§Øª ÙÙ‚Ø·

    if (recentPosts.length === 0) {
        postsGrid.innerHTML = `
            <div class="no-posts" style="grid-column: 1/-1; text-align: center; padding: 4rem;">
                <div style="font-size: 4rem; margin-bottom: 1rem;">ğŸŒº</div>
                <h3 style="color: var(--text-dark); margin-bottom: 1rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒØ§Øª Ø¨Ø¹Ø¯</h3>
                <p style="color: var(--text-light); margin-bottom: 2rem;">ÙƒÙˆÙ†ÙŠ Ø£ÙˆÙ„ Ù…Ù† ÙŠØ´Ø§Ø±Ùƒ Ø±ÙˆØªÙŠÙ†Ù‡Ø§ Ø§Ù„ÙŠÙˆÙ…ÙŠ!</p>
                <button class="btn-post" onclick="showPostForm()">
                    <i class="fas fa-plus"></i>
                    Ø§Ø¨Ø¯Ø¦ÙŠ Ø¨Ù…Ø´Ø§Ø±ÙƒØ© Ø±ÙˆØªÙŠÙ†Ùƒ
                </button>
            </div>
        `;
        return;
    }

    postsGrid.innerHTML = recentPosts.map(post => `
        <div class="post-card ${post.theme}" onclick="viewPost(${post.id})">
            <div class="post-header">
                <span class="post-theme ${post.theme}">
                    ${post.theme === 'morning' ? 'ğŸŒ ØµØ¨Ø§Ø­ÙŠ' : 'ğŸŒ™ Ù…Ø³Ø§Ø¦ÙŠ'}
                </span>
                <span class="post-date">${post.date}</span>
            </div>
            <h3 class="post-title">${post.title}</h3>
            <p class="post-content">${post.content}</p>
            <div class="post-meta">
                <button class="like-btn" onclick="event.stopPropagation(); likePost(${post.id})">
                    <i class="fas fa-heart"></i>
                    <span>${post.likes}</span>
                </button>
                <span class="post-author">${post.author}</span>
            </div>
        </div>
    `).join('');
}

// Ø¹Ø±Ø¶ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
function showPostForm() {
    document.getElementById('postModal').style.display = 'flex';
    document.body.style.overflow = 'hidden';
}

// Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
function hidePostForm() {
    document.getElementById('postModal').style.display = 'none';
    document.body.style.overflow = 'auto';
    document.getElementById('postForm').reset();
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø§Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©
document.getElementById('postForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const title = document.getElementById('postTitle').value;
    const content = document.getElementById('postContent').value;
    const theme = document.querySelector('input[name="theme"]:checked').value;
    
    const newPost = {
        id: Date.now(),
        title,
        content,
        theme,
        likes: 0,
        author: getRandomFemaleName(),
        date: new Date().toLocaleDateString('ar-AR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        }),
        timestamp: Date.now()
    };
    
    posts.unshift(newPost);
    savePosts();
    displayPosts();
    hidePostForm();
    
    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
    showNotification('ğŸ‰ ØªÙ… Ù†Ø´Ø± Ø±ÙˆØªÙŠÙ†Ùƒ Ø¨Ù†Ø¬Ø§Ø­!');
});

// Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø¨Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
function likePost(postId) {
    const post = posts.find(p => p.id === postId);
    if (post) {
        post.likes++;
        savePosts();
        displayPosts();
        
        // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨
        const likeBtn = event.target.closest('.like-btn');
        likeBtn.style.transform = 'scale(1.3)';
        setTimeout(() => {
            likeBtn.style.transform = 'scale(1)';
        }, 300);
    }
}

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
function viewPost(postId) {
    const post = posts.find(p => p.id === postId);
    if (post) {
        // Ù‡Ù†Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ØµÙØ­Ø© Ø¹Ø±Ø¶ Ù…ÙØµÙ„ Ù„Ù„Ù…Ø´Ø§Ø±ÙƒØ©
        alert(`ğŸ“– ${post.title}\n\n${post.content}\n\nâ¤ï¸ ${post.likes} Ø¥Ø¹Ø¬Ø§Ø¨`);
    }
}

// Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª ÙÙŠ localStorage
function savePosts() {
    localStorage.setItem('routinyat-posts', JSON.stringify(posts));
}

// Ø£Ø³Ù…Ø§Ø¡ Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ù„Ù„Ø¹Ø¶ÙˆØ§Øª
function getRandomFemaleName() {
    const names = [
        'Ø³Ø§Ø±Ø©', 'ÙØ§Ø·Ù…Ø©', 'Ù…Ø±ÙŠÙ…', 'Ù‡Ø¯Ù‰', 'Ù†ÙˆØ±', 'Ù„ÙŠÙ†Ø§', 'ÙŠØ§Ø³Ù…ÙŠÙ†', 'Ø±ÙŠÙ…', 
        'Ø£Ù…ÙŠÙ†Ø©', 'Ø²ÙŠÙ†Ø¨', 'Ø¢ÙŠØ©', 'Ø¬Ù†Ù‰', 'Ù„Ù…Ù‰', 'Ø±ÙˆØ§Ù†', 'Ø¯Ø§Ù„ÙŠØ§', 'Ø³Ù„ÙˆÙ‰'
    ];
    return names[Math.floor(Math.random() * names.length)];
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
function showNotification(message) {
    const notification = document.createElement('div');
    notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: linear-gradient(135deg, var(--primary-pink), var(--purple));
        color: white;
        padding: 1rem 2rem;
        border-radius: 15px;
        box-shadow: var(--shadow-hover);
        z-index: 3000;
        animation: slideInRight 0.3s ease;
        font-weight: 600;
    `;
    notification.textContent = message;
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.style.animation = 'slideOutRight 0.3s ease';
        setTimeout(() => {
            document.body.removeChild(notification);
        }, 300);
    }, 3000);
}

// Ø¥Ø¶Ø§ÙØ© Ø£Ù†ÙŠÙ…ÙŠØ´Ù† Ù„Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
const style = document.createElement('style');
style.textContent = `
    @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }
`;
document.head.appendChild(style);

// Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
document.addEventListener('DOMContentLoaded', function() {
    displayPosts();
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ÙŠÙ‡
    document.getElementById('postModal').addEventListener('click', function(e) {
        if (e.target === this) {
            hidePostForm();
        }
    });
    
    // Ù…Ù†Ø¹ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¯Ø§Ø®Ù„Ù‡
    document.querySelector('.modal-content').addEventListener('click', function(e) {
        e.stopPropagation();
    });
    
    // Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ±
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);
    
    // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¹Ù†Ø§ØµØ± Ù„Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª
    document.querySelectorAll('.post-card, .section-card').forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = 'all 0.6s ease';
        observer.observe(card);
    });
});
