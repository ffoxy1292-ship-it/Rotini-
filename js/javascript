// Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª
let posts = JSON.parse(localStorage.getItem('routinyat-posts')) || [];
let currentFilter = 'all';

// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª
function displayPosts() {
    const postsGrid = document.getElementById('postsGrid');
    const filteredPosts = currentFilter === 'all' 
        ? posts 
        : posts.filter(post => post.theme === currentFilter);

    if (filteredPosts.length === 0) {
        postsGrid.innerHTML = `
            <div class="no-posts">
                <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒØ§Øª Ø¨Ø¹Ø¯</h3>
                <p>ÙƒÙˆÙ†ÙŠ Ø£ÙˆÙ„ Ù…Ù† ÙŠØ´Ø§Ø±Ùƒ Ø±ÙˆØªÙŠÙ†Ù‡Ø§ Ø§Ù„ÙŠÙˆÙ…ÙŠ!</p>
            </div>
        `;
        return;
    }

    postsGrid.innerHTML = filteredPosts.map(post => `
        <div class="post-card ${post.theme}">
            <div class="post-header">
                <span class="post-theme ${post.theme}">
                    ${post.theme === 'morning' ? 'ğŸŒ ØµØ¨Ø§Ø­ÙŠ' : 'ğŸŒ™ Ù…Ø³Ø§Ø¦ÙŠ'}
                </span>
                <span class="post-date">${post.date}</span>
            </div>
            <h3 class="post-title">${post.title}</h3>
            <p class="post-content">${post.content}</p>
            <div class="post-meta">
                <button class="like-btn" onclick="likePost(${post.id})">
                    â¤ï¸ ${post.likes}
                </button>
                <span>Ø¨ÙˆØ§Ø³Ø·Ø©: ${post.author || 'Ù…Ø³ØªØ®Ø¯Ù…'}</span>
            </div>
        </div>
    `).join('');
}

// ØªØµÙÙŠØ© Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª
function filterPosts(filter) {
    currentFilter = filter;
    
    // ØªØ­Ø¯ÙŠØ« Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„ØªØ±
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    event.target.classList.add('active');
    
    displayPosts();
}

// Ø¥Ø¸Ù‡Ø§Ø± Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
function showPostForm() {
    document.getElementById('postFormOverlay').style.display = 'flex';
}

// Ø¥Ø®ÙØ§Ø¡ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
function hidePostForm() {
    document.getElementById('postFormOverlay').style.display = 'none';
    document.getElementById('addPostForm').reset();
}

// Ø¥Ø¶Ø§ÙØ© Ù…Ø´Ø§Ø±ÙƒØ© Ø¬Ø¯ÙŠØ¯Ø©
document.getElementById('addPostForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const title = document.getElementById('postTitle').value;
    const content = document.getElementById('postContent').value;
    const theme = document.querySelector('input[name="theme"]:checked').value;
    
    const newPost = {
        id: Date.now(),
        title,
        content,
        theme,
        likes: 0,
        author: 'Ù…Ø³ØªØ®Ø¯Ù…Ø©',
        date: new Date().toLocaleDateString('ar-AR', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        })
    };
    
    posts.unshift(newPost);
    savePosts();
    displayPosts();
    hidePostForm();
    
    alert('ğŸ‰ ØªÙ… Ù†Ø´Ø± Ø±ÙˆØªÙŠÙ†Ùƒ Ø¨Ù†Ø¬Ø§Ø­!');
});

// Ø§Ù„Ø¥Ø¹Ø¬Ø§Ø¨ Ø¨Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©
function likePost(postId) {
    const post = posts.find(p => p.id === postId);
    if (post) {
        post.likes++;
        savePosts();
        displayPosts();
    }
}

// Ø­ÙØ¸ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª ÙÙŠ localStorage
function savePosts() {
    localStorage.setItem('routinyat-posts', JSON.stringify(posts));
}

// Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
document.addEventListener('DOMContentLoaded', function() {
    displayPosts();
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬ÙŠÙ‡
    document.getElementById('postFormOverlay').addEventListener('click', function(e) {
        if (e.target === this) {
            hidePostForm();
        }
    });
});
